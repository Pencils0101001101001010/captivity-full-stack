generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

enum UserRole {
  USER
  CUSTOMER
  SUBSCRIBER
  PROMO
  DISTRIBUTOR
  SHOPMANAGER
  EDITOR
  ADMIN
}

model User {
  id               String  @id
  username         String  @unique
  firstName        String
  lastName         String
  displayName      String
  email            String  @unique
  passwordHash     String
  vatNumber        String?
  phoneNumber      Int
  streetAddress    String
  addressLine2     String?
  suburb           String?
  townCity         String
  postcode         String
  country          String
  position         String?
  natureOfBusiness String
  currentSupplier  String
  otherSupplier    String?
  resellingTo      String?
  salesRep         String
  website          String?
  companyName      String
  ckNumber         String?
  avatarUrl        String?
  bio              String?
  agreeTerms       Boolean @default(false)

  role     UserRole  @default(USER)
  sessions Session[]
  Product  Product[]
  Cart     Cart[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Session {
  id        String   @id
  userId    String
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Product {
  id                Int      @id @default(autoincrement())
  userId            String
  type              String
  sku               String
  name              String
  published         Boolean
  isFeatured        Boolean
  visibility        String
  shortDescription  String
  taxStatus         String
  inStock           Boolean
  backordersAllowed Boolean
  soldIndividually  Boolean
  allowReviews      Boolean
  categories        String
  tags              String
  imageUrl          String
  upsells           String?
  position          Int
  attribute1Name    String?
  attribute1Values  String?
  attribute2Name    String?
  attribute2Values  String?
  attribute1Default String?
  attribute2Default String?
  updatedAt         DateTime @updatedAt
  createdAt         DateTime @default(now())

  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  variants Variant[]
  CartItem CartItem[]

  @@map("products")
}

model Variant {
  id              Int     @id @default(autoincrement())
  productId       Int
  attribute1Value String?
  attribute2Value String?
  regularPrice    Float
  stock           Int

  product  Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  CartItem CartItem[]

  @@unique([productId, attribute1Value, attribute2Value])
  @@map("variants")
}

model Cart {
  id        Int        @id @default(autoincrement())
  userId    String
  users     User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  CartItem  CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("carts")
}

model CartItem {
  id        Int  @id @default(autoincrement())
  productId Int
  variantId Int?
  quantity  Int
  cartId    Int

  product Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant Variant? @relation(fields: [variantId], references: [id])
  cart    Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@map("cartItems")
}
